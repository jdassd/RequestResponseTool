<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Response Tool</title>
    <link rel="stylesheet" href="config.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Work+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="page">
        <header class="hero">
            <div>
                <p class="eyebrow" data-i18n="app_name">Request Response Tool</p>
                <h1 data-i18n="hero_title">掌控请求，精准改写。</h1>
                <p class="lede" data-i18n="hero_lede">重定向、拦截、修改请求/响应与注入脚本，所有能力集中在一个强大的控制面板。</p>
            </div>
            <div class="hero-card">
                <div>
                    <p class="label" data-i18n="status_label">扩展状态</p>
                    <div class="toggle-row">
                        <label class="switch">
                            <input type="checkbox" id="globalEnabled">
                            <span class="slider"></span>
                        </label>
                        <span id="globalStatus">启用</span>
                    </div>
                </div>
                <div class="stats">
                    <div>
                        <p class="label" data-i18n="stats_rules">规则</p>
                        <p class="stat" id="ruleCount">0</p>
                    </div>
                    <div>
                        <p class="label" data-i18n="stats_scripts">脚本</p>
                        <p class="stat" id="scriptCount">0</p>
                    </div>
                </div>
            </div>
        </header>

        <nav class="nav">
            <div class="nav-group">
                <button class="nav-btn active" data-section="rules" data-i18n="nav_rules">规则库</button>
                <button class="nav-btn" data-section="editor" data-i18n="nav_editor">规则编辑</button>
                <button class="nav-btn" data-section="tester" data-i18n="nav_tester">规则测试</button>
                <button class="nav-btn" data-section="scripts" data-i18n="nav_scripts">脚本注入</button>
                <button class="nav-btn" data-section="batch" data-i18n="nav_batch">批量请求</button>
                <button class="nav-btn" data-section="logs" data-i18n="nav_logs">命中日志</button>
                <button class="nav-btn" data-section="import" data-i18n="nav_import">导入导出</button>
            </div>
            <div class="nav-actions">
                <button class="ghost" id="langToggle" data-i18n="nav_lang">中文 / EN</button>
            </div>
        </nav>

        <section class="panel" id="rulesPanel" data-section="rules">
            <div class="panel-header">
                <div>
                    <h2 data-i18n="rules_title">规则库</h2>
                    <p data-i18n="rules_desc">拖拽排序、启用/禁用，每条规则都只存本地。</p>
                </div>
                <div class="actions">
                    <button class="ghost" id="newGroupBtn" data-i18n="rules_new_group">新建分组</button>
                    <button class="primary" id="newRuleBtn" data-i18n="rules_new">新建规则</button>
                </div>
            </div>
            <div class="rule-list" id="ruleList"></div>
        </section>

        <section class="panel" id="editorPanel" data-section="editor">
            <div class="panel-header">
                <div>
                    <h2 data-i18n="editor_title">规则编辑</h2>
                    <p data-i18n="editor_desc">选择匹配方式与动作，构建精确拦截。</p>
                </div>
                <div class="chip" id="editingBadge">创建中</div>
            </div>

            <div class="editor-grid">
                <div class="field span-2">
                    <label for="ruleName" data-i18n="rule_name_label">规则名称</label>
                    <input type="text" id="ruleName" data-placeholder="rule_name_placeholder" placeholder="本地资源替换">
                </div>
                <div class="field">
                    <label for="ruleGroup" data-i18n="rule_group_label">分组</label>
                    <select id="ruleGroup">
                        <option value="" data-i18n="rule_group_placeholder">选择分组</option>
                    </select>
                </div>
                <div class="field">
                    <label for="ruleType" data-i18n="rule_type_label">规则类型</label>
                    <select id="ruleType">
                        <option value="redirect" data-i18n="rule_type_redirect">重定向请求</option>
                        <option value="block" data-i18n="rule_type_block">拦截请求</option>
                        <option value="headers" data-i18n="rule_type_headers">修改 Headers</option>
                        <option value="mock" data-i18n="rule_type_mock">模拟响应</option>
                        <option value="intercept" data-i18n="rule_type_intercept">拦截并改写请求/响应</option>
                    </select>
                </div>
                <div class="field">
                    <label for="rulePriority" data-i18n="rule_priority_label">优先级</label>
                    <input type="number" id="rulePriority" min="1" value="1">
                </div>
                <div class="field">
                    <label for="ruleEnabled" data-i18n="rule_enabled_label">启用</label>
                    <select id="ruleEnabled">
                        <option value="true" data-i18n="rule_enabled_true">启用</option>
                        <option value="false" data-i18n="rule_enabled_false">停用</option>
                    </select>
                </div>
            </div>

            <div class="subpanel">
                <h3 data-i18n="match_title">匹配条件</h3>
                <div class="editor-grid">
                    <div class="field">
                        <label for="ruleMethod" data-i18n="label_method">请求方法</label>
                        <select id="ruleMethod">
                            <option value="*" data-i18n="method_any">任意</option>
                            <option value="get">GET</option>
                            <option value="post">POST</option>
                            <option value="put">PUT</option>
                            <option value="delete">DELETE</option>
                            <option value="patch">PATCH</option>
                        </select>
                    </div>
                    <div class="field">
                        <label for="matchType" data-i18n="match_type_label">匹配类型</label>
                        <select id="matchType">
                            <option value="string" data-i18n="match_type_string">字符串</option>
                            <option value="wildcard" data-i18n="match_type_wildcard">通配符</option>
                            <option value="regex" data-i18n="match_type_regex">正则</option>
                        </select>
                    </div>
                    <div class="field span-2">
                        <label for="matchValue" data-i18n="match_value_label">匹配内容</label>
                        <input type="text" id="matchValue" data-placeholder="match_value_placeholder" placeholder="https://api.example.com/*">
                    </div>
                </div>
            </div>

            <div class="subpanel" id="redirectFields">
                <h3 data-i18n="redirect_title">重定向目标</h3>
                <div class="editor-grid">
                    <div class="field">
                        <label for="redirectMode" data-i18n="redirect_mode_label">模式</label>
                        <select id="redirectMode">
                            <option value="url" data-i18n="redirect_mode_url">完全重定向</option>
                            <option value="replace" data-i18n="redirect_mode_replace">字符串替换</option>
                        </select>
                    </div>
                    <div class="field span-3" id="redirectUrlField">
                        <label for="redirectUrl" data-i18n="redirect_url_label">目标 URL</label>
                        <input type="text" id="redirectUrl" data-placeholder="redirect_url_placeholder" placeholder="http://localhost:3000/app.js">
                    </div>
                    <div class="field" id="redirectFindField" style="display:none;">
                        <label for="redirectFind" data-i18n="redirect_find_label">查找字符串</label>
                        <input type="text" id="redirectFind" data-placeholder="redirect_find_placeholder" placeholder="prod">
                    </div>
                    <div class="field span-2" id="redirectReplaceField" style="display:none;">
                        <label for="redirectReplace" data-i18n="redirect_replace_label">替换为</label>
                        <input type="text" id="redirectReplace" data-placeholder="redirect_replace_placeholder" placeholder="stage">
                    </div>
                </div>
            </div>

            <div class="subpanel" id="blockFields">
                <h3 data-i18n="block_title">拦截选项</h3>
                <p class="hint" data-i18n="block_hint">命中后请求会显示 failed / blocked。</p>
            </div>

            <div class="subpanel" id="headersFields">
                <h3 data-i18n="headers_title">Header 修改</h3>
                <div class="headers-section">
                    <div class="headers-header">
                        <p data-i18n="headers_request_label">请求 Headers</p>
                        <button class="ghost" id="addRequestHeader" data-i18n="headers_add">添加</button>
                    </div>
                    <div class="headers-list" id="requestHeadersList"></div>
                </div>
                <div class="headers-section">
                    <div class="headers-header">
                        <p data-i18n="headers_response_label">响应 Headers</p>
                        <button class="ghost" id="addResponseHeader" data-i18n="headers_add">添加</button>
                    </div>
                    <div class="headers-list" id="responseHeadersList"></div>
                </div>
            </div>

            <div class="subpanel" id="mockFields">
                <h3 data-i18n="mock_title">模拟响应</h3>
                <div class="editor-grid">
                    <div class="field">
                        <label for="mockStatus" data-i18n="mock_status_label">状态码</label>
                        <input type="number" id="mockStatus" value="200" min="100" max="599">
                    </div>
                    <div class="field">
                        <label for="mockDelay" data-i18n="label_delay">延时 (毫秒)</label>
                        <input type="number" id="mockDelay" value="0" min="0">
                    </div>
                    <div class="field span-2">
                        <label for="mockContentType" data-i18n="mock_content_type_label">Content-Type</label>
                        <input type="text" id="mockContentType" data-placeholder="mock_content_type_placeholder" placeholder="application/json">
                    </div>
                </div>
                <div class="field">
                    <label for="mockBody" data-i18n="mock_body_label">响应内容</label>
                    <textarea id="mockBody" rows="6" data-placeholder="mock_body_placeholder" placeholder='{"ok": true}'></textarea>
                    <p class="hint" data-i18n="mock_hint">MV3 使用 data URL 返回响应，状态码仅用于记录展示。</p>
                </div>
            </div>

            <div class="subpanel" id="interceptFields">
                <h3 data-i18n="intercept_title">拦截并改写</h3>
                <div class="split">
                    <div class="subpanel">
                        <h4 data-i18n="intercept_request_title">请求</h4>
                        <div class="editor-grid">
                            <div class="field">
                                <label for="interceptRequestMode" data-i18n="intercept_request_mode_label">模式</label>
                                <select id="interceptRequestMode">
                                    <option value="pass" data-i18n="intercept_request_mode_pass">放行</option>
                                    <option value="block" data-i18n="intercept_request_mode_block">拦截</option>
                                    <option value="modify" data-i18n="intercept_request_mode_modify">改写</option>
                                </select>
                            </div>
                            <div class="field span-3">
                                <label for="interceptRequestUrl" data-i18n="intercept_request_url_label">覆盖 URL（可选）</label>
                                <input type="text" id="interceptRequestUrl" data-placeholder="intercept_request_url_placeholder" placeholder="https://api.example.com/v2">
                            </div>
                        </div>
                        <div class="field">
                            <label for="interceptRequestHeaders" data-i18n="intercept_request_headers_label">Headers JSON</label>
                            <textarea id="interceptRequestHeaders" rows="4" data-placeholder="intercept_request_headers_placeholder" placeholder='{"X-Trace":"on","X-Remove":null}'></textarea>
                        </div>
                        <div class="field">
                            <label for="interceptRequestBody" data-i18n="intercept_request_body_label">Body（原始或 JSON）</label>
                            <textarea id="interceptRequestBody" rows="4" data-placeholder="intercept_request_body_placeholder" placeholder='{"env":"staging"}'></textarea>
                        </div>
                    </div>
                    <div class="subpanel">
                        <h4 data-i18n="intercept_response_title">响应</h4>
                        <div class="editor-grid">
                            <div class="field">
                                <label for="interceptResponseMode" data-i18n="intercept_response_mode_label">模式</label>
                                <select id="interceptResponseMode">
                                    <option value="pass" data-i18n="intercept_response_mode_pass">放行</option>
                                    <option value="mock" data-i18n="intercept_response_mode_mock">模拟</option>
                                    <option value="modify" data-i18n="intercept_response_mode_modify">改写</option>
                                </select>
                            </div>
                            <div class="field">
                                <label for="interceptResponseStatus" data-i18n="intercept_response_status_label">状态码</label>
                                <input type="number" id="interceptResponseStatus" value="200" min="100" max="599">
                            </div>
                        </div>
                        <div class="field">
                            <label for="interceptDelay" data-i18n="label_delay">延时 (毫秒)</label>
                            <input type="number" id="interceptDelay" value="0" min="0">
                        </div>
                        <div class="field">
                            <label for="interceptResponseHeaders" data-i18n="intercept_response_headers_label">Headers JSON</label>
                            <textarea id="interceptResponseHeaders" rows="4" data-placeholder="intercept_response_headers_placeholder" placeholder='{"Content-Type":"application/json"}'></textarea>
                        </div>
                        <div class="field">
                            <label for="interceptResponseBody" data-i18n="intercept_response_body_label">Body 模板（可用 {{body}}）</label>
                            <textarea id="interceptResponseBody" rows="4" data-placeholder="intercept_response_body_placeholder" placeholder='{"data":{{body}}}'></textarea>
                            <p class="hint" data-i18n="intercept_response_body_hint">{{body}} 会被原始响应文本替换。</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="actions">
                <button class="ghost" id="resetRule" data-i18n="rule_reset">重置</button>
                <button class="primary" id="saveRule" data-i18n="rule_save">保存规则</button>
                <span class="status" id="ruleStatus"></span>
            </div>
        </section>

        <section class="panel" id="testerPanel" data-section="tester">
            <div class="panel-header">
                <div>
                    <h2 data-i18n="tester_title">规则测试</h2>
                    <p data-i18n="tester_desc">输入 URL，查看匹配的规则顺序。</p>
                </div>
            </div>
            <div class="editor-grid">
                <div class="field span-3">
                    <label for="testUrl" data-i18n="tester_url_label">测试 URL</label>
                    <input type="text" id="testUrl" data-placeholder="tester_url_placeholder" placeholder="https://api.example.com/v1/users">
                </div>
                <div class="field">
                    <label>&nbsp;</label>
                    <button class="primary" id="runTest" data-i18n="tester_run">开始测试</button>
                </div>
            </div>
            <div id="testResults" class="test-results"></div>
        </section>

        <section class="panel" id="scriptPanel" data-section="scripts">
            <div class="panel-header">
                <div>
                    <h2 data-i18n="scripts_title">脚本注入</h2>
                    <p data-i18n="scripts_desc">在指定时机注入 JS/CSS。</p>
                </div>
                <button class="primary" id="newScriptBtn" data-i18n="scripts_new">新建脚本</button>
            </div>
            <div class="rule-list" id="scriptList"></div>

            <div class="subpanel">
                <h3 data-i18n="script_editor_title">脚本编辑</h3>
                <div class="editor-grid">
                    <div class="field">
                        <label for="scriptName" data-i18n="script_name_label">脚本名称</label>
                        <input type="text" id="scriptName" data-placeholder="script_name_placeholder" placeholder="高亮调试">
                    </div>
                    <div class="field">
                        <label for="scriptRunAt" data-i18n="script_runat_label">注入时机</label>
                        <select id="scriptRunAt">
                            <option value="document_start" data-i18n="script_runat_start">文档开始</option>
                            <option value="document_end" data-i18n="script_runat_ready">DOM 就绪</option>
                            <option value="document_idle" data-i18n="script_runat_idle">空闲阶段</option>
                        </select>
                    </div>
                    <div class="field">
                        <label for="scriptEnabled" data-i18n="script_enabled_label">启用</label>
                        <select id="scriptEnabled">
                            <option value="true" data-i18n="script_enabled_true">启用</option>
                            <option value="false" data-i18n="script_enabled_false">停用</option>
                        </select>
                    </div>
                </div>
                <div class="subpanel">
                    <h3 data-i18n="script_match_title">匹配条件</h3>
                    <div class="editor-grid">
                        <div class="field">
                            <label for="scriptMatchType" data-i18n="script_match_type_label">匹配类型</label>
                            <select id="scriptMatchType">
                                <option value="string" data-i18n="match_type_string">字符串</option>
                                <option value="wildcard" data-i18n="match_type_wildcard">通配符</option>
                                <option value="regex" data-i18n="match_type_regex">正则</option>
                            </select>
                        </div>
                        <div class="field span-3">
                            <label for="scriptMatchValue" data-i18n="script_match_value_label">匹配内容</label>
                            <input type="text" id="scriptMatchValue" data-placeholder="script_match_value_placeholder" placeholder="*://*.example.com/*">
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label for="scriptJs" data-i18n="script_js_label">JavaScript</label>
                    <textarea id="scriptJs" rows="6" data-placeholder="script_js_placeholder" placeholder="console.log('Injected!');"></textarea>
                </div>
                <div class="field">
                    <label for="scriptCss" data-i18n="script_css_label">CSS</label>
                    <textarea id="scriptCss" rows="5" data-placeholder="script_css_placeholder" placeholder="body { outline: 4px solid hotpink; }"></textarea>
                </div>
                <div class="actions">
                    <button class="ghost" id="resetScript" data-i18n="script_reset">重置</button>
                    <button class="primary" id="saveScript" data-i18n="script_save">保存脚本</button>
                </div>
            </div>
        </section>

        <section class="panel" id="batchPanel" data-section="batch">
            <div class="panel-header">
                <div>
                    <h2 data-i18n="batch_title">批量请求</h2>
                    <p data-i18n="batch_desc">读取 CSV/XLSX/JSON 数据并并发发送请求。</p>
                </div>
            </div>
            <div class="editor-grid">
                <div class="field span-3">
                    <label for="batchUrl" data-i18n="batch_url_label">请求 URL 模板</label>
                    <input type="text" id="batchUrl" data-placeholder="batch_url_placeholder" placeholder="https://api.example.com/users/{{id}}">
                </div>
                <div class="field">
                    <label for="batchMethod" data-i18n="batch_method_label">请求方法</label>
                    <select id="batchMethod">
                        <option value="GET">GET</option>
                        <option value="POST">POST</option>
                        <option value="PUT">PUT</option>
                        <option value="PATCH">PATCH</option>
                        <option value="DELETE">DELETE</option>
                    </select>
                </div>
                <div class="field span-3">
                    <label for="batchHeaders" data-i18n="batch_headers_label">Headers 模板</label>
                    <textarea id="batchHeaders" rows="3" data-placeholder="batch_headers_placeholder" placeholder='{"Authorization":"Bearer {{token}}"}'></textarea>
                </div>
                <div class="field span-3">
                    <label for="batchBody" data-i18n="batch_body_label">Body 模板</label>
                    <textarea id="batchBody" rows="4" data-placeholder="batch_body_placeholder" placeholder='{"email":"{{email}}"}'></textarea>
                </div>
                <div class="field">
                    <label for="batchConcurrency" data-i18n="batch_concurrency_label">并发数</label>
                    <input type="number" id="batchConcurrency" value="4" min="1" max="50">
                </div>
                <div class="field">
                    <label for="batchTimeout" data-i18n="batch_timeout_label">超时时间（ms）</label>
                    <input type="number" id="batchTimeout" value="15000" min="1000">
                </div>
            </div>
            <div class="actions">
                <label class="ghost file-btn" data-i18n="batch_load_button">
                    导入 CSV / XLSX / JSON
                    <input type="file" id="batchFile" accept=".csv,.xlsx,.xls,.json">
                </label>
                <button class="primary" id="batchStart" data-i18n="batch_start_button">开始</button>
                <button class="ghost" id="batchStop" data-i18n="batch_stop_button">停止</button>
                <span class="status" id="batchStatus"></span>
            </div>
            <div class="batch-metrics" id="batchMetrics"></div>
            <div class="batch-results" id="batchResults"></div>
        </section>

        <section class="panel" id="logsPanel" data-section="logs">
            <div class="panel-header">
                <div>
                    <h2 data-i18n="logs_title">命中日志</h2>
                    <p data-i18n="logs_desc">记录 declarative 规则命中情况。</p>
                </div>
                <button class="ghost" id="clearLogs" data-i18n="logs_clear">清空日志</button>
            </div>
            <div class="log-list" id="logList"></div>
        </section>

        <section class="panel" id="importExport" data-section="import">
            <div class="panel-header">
                <div>
                    <h2 data-i18n="import_title">导入 / 导出</h2>
                    <p data-i18n="import_desc">用 JSON 共享规则配置。</p>
                </div>
            </div>
            <div class="actions">
                <button class="ghost" id="exportBtn" data-i18n="export_button">导出 JSON</button>
                <label class="ghost file-btn" data-i18n="import_button">
                    导入 JSON
                    <input type="file" id="importInput" accept="application/json">
                </label>
                <span id="importStatus" class="hint"></span>
            </div>
        </section>
    </div>

    <script src="xlsx.full.min.js"></script>
    <script src="config.js"></script>
</body>
</html>
